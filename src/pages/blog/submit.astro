---
// This is the blog submission form page
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Write Your Story - Artist Blog</title>
    <meta name="description" content="Share your artistic journey, insights, and stories with the artist community." />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        line-height: 1.6;
        color: #1a1a1a;
        background: #fafafa;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 20px;
      }

      /* Header */
      .header {
        background: white;
        padding: 1rem 0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: bold;
        color: #1a1a1a;
        text-decoration: none;
      }

      .nav-links {
        display: flex;
        gap: 2rem;
        list-style: none;
      }

      .nav-links a {
        color: #666;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
      }

      .nav-links a:hover,
      .nav-links a.active {
        color: #1a1a1a;
      }

      .back-link {
        color: #667eea;
        text-decoration: none;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        margin: 2rem 0;
        transition: all 0.3s;
      }

      .back-link:hover {
        color: #5a6fd8;
        transform: translateX(-3px);
      }

      /* Page Header */
      .page-header {
        text-align: center;
        padding: 3rem 0;
        background: white;
        margin-bottom: 2rem;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      }

      .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: #1a1a1a;
      }

      .page-subtitle {
        font-size: 1.2rem;
        color: #666;
        max-width: 600px;
        margin: 0 auto;
      }

      /* Form Styles */
      .form-container {
        background: white;
        border-radius: 12px;
        padding: 3rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-bottom: 3rem;
      }

      .form-group {
        margin-bottom: 2rem;
      }

      .form-label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #1a1a1a;
        font-size: 1rem;
      }

      .form-input,
      .form-select,
      .form-textarea {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 16px;
        font-family: inherit;
        transition: all 0.3s;
        background: white;
      }

      .form-input:focus,
      .form-select:focus,
      .form-textarea:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .form-textarea {
        resize: vertical;
        min-height: 120px;
      }

      .content-textarea {
        min-height: 400px;
        font-family: 'Georgia', serif;
        font-size: 18px;
        line-height: 1.7;
      }

      .form-help {
        font-size: 0.9rem;
        color: #666;
        margin-top: 0.5rem;
      }

      .character-count {
        font-size: 0.8rem;
        color: #999;
        text-align: right;
        margin-top: 0.25rem;
      }

      /* Tags Input */
      .tags-container {
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 8px;
        min-height: 50px;
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
        cursor: text;
        transition: border-color 0.3s;
      }

      .tags-container:focus-within {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .tag-item {
        background: #667eea;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .tag-remove {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        font-size: 1rem;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s;
      }

      .tag-remove:hover {
        background: rgba(255,255,255,0.2);
      }

      .tag-input {
        border: none;
        outline: none;
        background: transparent;
        flex: 1;
        min-width: 120px;
        padding: 8px 4px;
        font-size: 16px;
      }

      .suggested-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      .suggested-tag {
        background: #f8f9fa;
        color: #666;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.8rem;
        cursor: pointer;
        border: 1px solid #e9ecef;
        transition: all 0.3s;
      }

      .suggested-tag:hover {
        background: #667eea;
        color: white;
        border-color: #667eea;
      }

      /* Form Sections */
      .form-section {
        margin-bottom: 3rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid #f0f0f0;
      }

      .form-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .section-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: #1a1a1a;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .section-icon {
        font-size: 1.2rem;
      }

      /* Form Grid */
      .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
      }

      /* Preview */
      .preview-toggle {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      .preview-btn {
        background: #f8f9fa;
        border: 2px solid #e9ecef;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s;
      }

      .preview-btn.active {
        background: #667eea;
        color: white;
        border-color: #667eea;
      }

      .preview-content {
        background: #f8f9fa;
        padding: 2rem;
        border-radius: 8px;
        min-height: 400px;
        font-family: 'Georgia', serif;
        font-size: 18px;
        line-height: 1.7;
      }

      .preview-content h2 {
        font-size: 1.6rem;
        margin: 2rem 0 1rem;
        color: #1a1a1a;
      }

      .preview-content h3 {
        font-size: 1.3rem;
        margin: 1.5rem 0 0.75rem;
        color: #1a1a1a;
      }

      .preview-content p {
        margin-bottom: 1.5rem;
      }

      /* Submit Button */
      .submit-section {
        text-align: center;
        padding: 2rem 0;
        margin-top: 2rem;
        border-top: 1px solid #f0f0f0;
      }

      .submit-btn {
        background: #667eea;
        color: white;
        padding: 16px 32px;
        border: none;
        border-radius: 8px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        min-width: 200px;
      }

      .submit-btn:hover {
        background: #5a6fd8;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }

      .submit-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .save-draft-btn {
        background: transparent;
        color: #667eea;
        padding: 16px 32px;
        border: 2px solid #667eea;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-right: 1rem;
      }

      .save-draft-btn:hover {
        background: #667eea;
        color: white;
      }

      /* Loading State */
      .loading {
        display: none;
        text-align: center;
        padding: 2rem;
        color: #666;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .page-title {
          font-size: 2rem;
        }

        .form-container {
          padding: 2rem 1.5rem;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .nav-links {
          gap: 1rem;
        }

        .submit-section {
          flex-direction: column;
          gap: 1rem;
        }

        .save-draft-btn {
          margin-right: 0;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <nav class="nav">
        <a href="/" class="logo">🎵 Artist Events</a>
        <ul class="nav-links">
          <li><a href="/">Home</a></li>
          <li><a href="/events">Events</a></li>
          <li><a href="/blog">Blog</a></li>
          <li><a href="/blog/submit" class="active">Write</a></li>
          <li><a href="/search">Search</a></li>
        </ul>
      </nav>
    </header>

    <div class="container">
      <a href="/blog" class="back-link">← Back to Blog</a>

      <!-- Page Header -->
      <section class="page-header">
        <h1 class="page-title">Share Your Story</h1>
        <p class="page-subtitle">Connect with fellow artists and music lovers by sharing your insights, experiences, and creative journey.</p>
      </section>

      <!-- Form -->
      <form class="form-container" id="blogForm">
        <!-- Basic Information -->
        <div class="form-section">
          <h2 class="section-title">
            <span class="section-icon">📝</span>
            Basic Information
          </h2>
          
          <div class="form-group">
            <label class="form-label" for="title">Title *</label>
            <input type="text" id="title" name="title" class="form-input" required 
                   placeholder="Give your story a compelling title...">
            <div class="character-count" id="titleCount">0/100 characters</div>
          </div>

          <div class="form-group">
            <label class="form-label" for="excerpt">Excerpt *</label>
            <textarea id="excerpt" name="excerpt" class="form-textarea" required
                      placeholder="Write a brief summary that will make people want to read your full story..."></textarea>
            <div class="character-count" id="excerptCount">0/300 characters</div>
            <div class="form-help">This will be shown on the blog listing page.</div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label class="form-label" for="category">Category *</label>
              <select id="category" name="category" class="form-select" required>
                <option value="">Select a category</option>
                <option value="Music & Performance">Music & Performance</option>
                <option value="Production & Technology">Production & Technology</option>
                <option value="Songwriting & Lyrics">Songwriting & Lyrics</option>
                <option value="Industry Insights">Industry Insights</option>
                <option value="Artist Life">Artist Life</option>
                <option value="Creative Process">Creative Process</option>
                <option value="Inspiration & Motivation">Inspiration & Motivation</option>
                <option value="Collaboration">Collaboration</option>
                <option value="Business & Marketing">Business & Marketing</option>
                <option value="Personal Stories">Personal Stories</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="readTime">Estimated Read Time</label>
              <select id="readTime" name="readTime" class="form-select">
                <option value="1 min read">1 min read</option>
                <option value="2 min read">2 min read</option>
                <option value="3 min read">3 min read</option>
                <option value="5 min read" selected>5 min read</option>
                <option value="8 min read">8 min read</option>
                <option value="10+ min read">10+ min read</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Author Information -->
        <div class="form-section">
          <h2 class="section-title">
            <span class="section-icon">👤</span>
            Author Information
          </h2>
          
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label" for="author">Your Name *</label>
              <input type="text" id="author" name="author" class="form-input" required 
                     placeholder="Your full name">
            </div>

            <div class="form-group">
              <label class="form-label" for="authorEmail">Email *</label>
              <input type="email" id="authorEmail" name="authorEmail" class="form-input" required 
                     placeholder="your@email.com">
              <div class="form-help">Won't be displayed publicly</div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="authorBio">Author Bio *</label>
            <textarea id="authorBio" name="authorBio" class="form-textarea" required
                      placeholder="Tell readers a bit about yourself, your musical background, and what you do..."></textarea>
            <div class="character-count" id="bioCount">0/200 characters</div>
          </div>
        </div>

        <!-- Content -->
        <div class="form-section">
          <h2 class="section-title">
            <span class="section-icon">✍️</span>
            Your Story
          </h2>

          <div class="preview-toggle">
            <button type="button" class="preview-btn active" id="writeBtn">Write</button>
            <button type="button" class="preview-btn" id="previewBtn">Preview</button>
          </div>

          <div class="form-group">
            <div id="writeTab">
              <textarea id="content" name="content" class="form-textarea content-textarea" required
                        placeholder="Share your story here...

You can format your text using:
- ## for headings
- ### for subheadings  
- Leave blank lines between paragraphs
- Use ** for bold text
- Use lists with - or numbered lists

Tell your story authentically. What do you want other artists to know? What have you learned? What experiences shaped your artistic journey?"></textarea>
              <div class="form-help">
                Tip: Write naturally and authentically. Share insights, experiences, or knowledge that could help fellow artists.
              </div>
            </div>
            <div id="previewTab" style="display: none;">
              <div class="preview-content" id="previewContent">
                Start writing to see your preview here...
              </div>
            </div>
          </div>
        </div>

        <!-- Tags -->
        <div class="form-section">
          <h2 class="section-title">
            <span class="section-icon">🏷️</span>
            Tags & Topics
          </h2>
          
          <div class="form-group">
            <label class="form-label">Tags</label>
            <div class="tags-container" id="tagsContainer">
              <input type="text" class="tag-input" id="tagInput" placeholder="Type a tag and press Enter">
            </div>
            <div class="form-help">Add relevant tags to help people discover your story. Press Enter after each tag.</div>
            
            <div class="suggested-tags">
              <span class="suggested-tag" data-tag="music">music</span>
              <span class="suggested-tag" data-tag="performance">performance</span>
              <span class="suggested-tag" data-tag="creativity">creativity</span>
              <span class="suggested-tag" data-tag="inspiration">inspiration</span>
              <span class="suggested-tag" data-tag="songwriting">songwriting</span>
              <span class="suggested-tag" data-tag="production">production</span>
              <span class="suggested-tag" data-tag="collaboration">collaboration</span>
              <span class="suggested-tag" data-tag="industry">industry</span>
              <span class="suggested-tag" data-tag="personal growth">personal growth</span>
              <span class="suggested-tag" data-tag="music theory">music theory</span>
              <span class="suggested-tag" data-tag="gear">gear</span>
              <span class="suggested-tag" data-tag="recording">recording</span>
            </div>
          </div>
        </div>

        <!-- Submit -->
        <div class="submit-section">
          <button type="button" class="save-draft-btn" id="saveDraftBtn">Save Draft</button>
          <button type="submit" class="submit-btn" id="submitBtn">Publish Story</button>
        </div>

        <div class="loading" id="loadingDiv">
          <div class="spinner"></div>
          <p>Publishing your story...</p>
        </div>
      </form>
    </div>

    <script>
      // Character counters
      const setupCharacterCounter = (inputId, counterId, maxLength) => {
        const input = document.getElementById(inputId);
        const counter = document.getElementById(counterId);
        
        input.addEventListener('input', () => {
          const length = input.value.length;
          counter.textContent = `${length}/${maxLength} characters`;
          counter.style.color = length > maxLength ? '#dc3545' : '#999';
        });
      };

      setupCharacterCounter('title', 'titleCount', 100);
      setupCharacterCounter('excerpt', 'excerptCount', 300);
      setupCharacterCounter('authorBio', 'bioCount', 200);

      // Tags functionality
      const tags = [];
      const tagsContainer = document.getElementById('tagsContainer');
      const tagInput = document.getElementById('tagInput');

      const renderTags = () => {
        const existingTags = tagsContainer.querySelectorAll('.tag-item');
        existingTags.forEach(tag => tag.remove());

        tags.forEach((tag, index) => {
          const tagElement = document.createElement('div');
          tagElement.className = 'tag-item';
          tagElement.innerHTML = `
            ${tag}
            <button type="button" class="tag-remove" onclick="removeTag(${index})">×</button>
          `;
          tagsContainer.insertBefore(tagElement, tagInput);
        });
      };

      const addTag = (tagText) => {
        const tag = tagText.trim().toLowerCase();
        if (tag && !tags.includes(tag) && tags.length < 10) {
          tags.push(tag);
          renderTags();
          tagInput.value = '';
        }
      };

      const removeTag = (index) => {
        tags.splice(index, 1);
        renderTags();
      };

      window.removeTag = removeTag; // Make it global for onclick

      tagInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          addTag(tagInput.value);
        } else if (e.key === 'Backspace' && tagInput.value === '' && tags.length > 0) {
          removeTag(tags.length - 1);
        }
      });

      // Suggested tags
      document.querySelectorAll('.suggested-tag').forEach(tag => {
        tag.addEventListener('click', () => {
          addTag(tag.dataset.tag);
        });
      });

      // Preview functionality
      const writeBtn = document.getElementById('writeBtn');
      const previewBtn = document.getElementById('previewBtn');
      const writeTab = document.getElementById('writeTab');
      const previewTab = document.getElementById('previewTab');
      const contentTextarea = document.getElementById('content');
      const previewContent = document.getElementById('previewContent');

      const formatContent = (text) => {
        if (!text.trim()) return 'Start writing to see your preview here...';
        
        return text
          .split('\n\n')
          .map(paragraph => {
            if (paragraph.startsWith('## ')) {
              return `<h2>${paragraph.substring(3)}</h2>`;
            } else if (paragraph.startsWith('### ')) {
              return `<h3>${paragraph.substring(4)}</h3>`;
            } else if (paragraph.trim() !== '') {
              return `<p>${paragraph.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>`;
            }
            return '';
          })
          .join('');
      };

      writeBtn.addEventListener('click', () => {
        writeBtn.classList.add('active');
        previewBtn.classList.remove('active');
        writeTab.style.display = 'block';
        previewTab.style.display = 'none';
      });

      previewBtn.addEventListener('click', () => {
        previewBtn.classList.add('active');
        writeBtn.classList.remove('active');
        writeTab.style.display = 'none';
        previewTab.style.display = 'block';
        previewContent.innerHTML = formatContent(contentTextarea.value);
      });

      // Form submission
      const blogForm = document.getElementById('blogForm');
      const submitBtn = document.getElementById('submitBtn');
      const loadingDiv = document.getElementById('loadingDiv');

      blogForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = new FormData(blogForm);
        const blogData = {
          title: formData.get('title'),
          excerpt: formData.get('excerpt'),
          category: formData.get('category'),
          readTime: formData.get('readTime'),
          author: formData.get('author'),
          authorEmail: formData.get('authorEmail'),
          authorBio: formData.get('authorBio'),
          content: formData.get('content'),
          tags: tags,
          publishedDate: new Date().toISOString().split('T')[0],
          featured: false,
          likes: 0,
          comments: 0
        };

        // Show loading
        submitBtn.style.display = 'none';
        loadingDiv.style.display = 'block';

        try {
          const response = await fetch('/api/save-blog', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(blogData)
          });

          if (response.ok) {
            const result = await response.json();
            alert('Your story has been published successfully!');
            window.location.href = `/blog/${result.slug}`;
          } else {
            throw new Error('Failed to publish story');
          }
        } catch (error) {
          console.error('Error:', error);
          alert('There was an error publishing your story. Please try again.');
          submitBtn.style.display = 'block';
          loadingDiv.style.display = 'none';
        }
      });

      // Save draft functionality
      document.getElementById('saveDraftBtn').addEventListener('click', () => {
        const formData = new FormData(blogForm);
        const draftData = {
          title: formData.get('title'),
          excerpt: formData.get('excerpt'),
          category: formData.get('category'),
          readTime: formData.get('readTime'),
          author: formData.get('author'),
          authorEmail: formData.get('authorEmail'),
          authorBio: formData.get('authorBio'),
          content: formData.get('content'),
          tags: tags
        };

        localStorage.setItem('blogDraft', JSON.stringify(draftData));
        alert('Draft saved locally!');
      });

      // Load draft on page load
      window.addEventListener('load', () => {
        const savedDraft = localStorage.getItem('blogDraft');
        if (savedDraft) {
          const draft = JSON.parse(savedDraft);
          Object.keys(draft).forEach(key => {
            if (key === 'tags') {
              tags.push(...draft[key]);
              renderTags();
            } else {
              const input = document.getElementById(key) || document.getElementsByName(key)[0];
              if (input) input.value = draft[key];
            }
          });
        }
      });
    </script>
  </body>
</html> 